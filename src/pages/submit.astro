---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Submit a Tool - Linux Directory">
  <div class="form-container">
    
    <!-- Header -->
    <div class="form-header">
      <h1 class="form-title">Submit a Tool</h1>
      <p class="form-subtitle">
        Help the community discover amazing Linux and open-source tools. All submissions are reviewed within 24 hours.
      </p>
    </div>
    
    <!-- Form Container -->
    <div class="form-wrapper">
      
      <form id="submit-form" style="display: block;">
        <!-- Tool Name & Category -->
        <div class="form-grid">
          <div>
            <label class="form-label">
              Tool Name *
            </label>
            <input 
              type="text" 
              name="name" 
              required
              placeholder="e.g., Docker, Ubuntu, VS Code"
              class="form-input"
            />
          </div>
          <div>
            <label class="form-label">
              Category *
            </label>
            <select 
              name="category" 
              required
              class="form-select"
            >
              <option value="">Select category</option>
              <option value="Operating Systems">Operating Systems</option>
              <option value="Development Tools">Development Tools</option>
              <option value="DevOps Tools">DevOps Tools</option>
              <option value="Security Tools">Security Tools</option>
              <option value="Media Tools">Media Tools</option>
              <option value="Productivity">Productivity</option>
              <option value="System Administration">System Administration</option>
              <option value="Networking">Networking</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label class="form-label">
            Description *
          </label>
          <textarea 
            name="description" 
            required
            rows="4"
            placeholder="Describe what this tool does, its key features, and why it's useful..."
            class="form-textarea"
          ></textarea>
        </div>

        <!-- Website & GitHub -->
        <div class="form-grid">
          <div>
            <label class="form-label">
              Website URL *
            </label>
            <input 
              type="url" 
              name="website" 
              required
              placeholder="https://example.com"
              class="form-input"
            />
          </div>
          <div>
            <label class="form-label">
              GitHub Repository
            </label>
            <input 
              type="url" 
              name="github"
              placeholder="https://github.com/user/repo"
              class="form-input"
            />
          </div>
        </div>

        <!-- Tags & Pricing -->
        <div class="form-grid">
          <div>
            <label class="form-label">
              Tags (comma-separated)
            </label>
            <input 
              type="text" 
              name="tags"
              placeholder="linux, open-source, cli, python"
              class="form-input"
            />
          </div>
          <div>
            <label class="form-label">
              Pricing Model *
            </label>
            <select 
              name="pricing" 
              required
              class="form-select"
            >
              <option value="">Select pricing</option>
              <option value="free">Free</option>
              <option value="open-source">Open Source</option>
              <option value="freemium">Freemium</option>
              <option value="paid">Paid</option>
            </select>
          </div>
        </div>

        <!-- Your Email -->
        <div class="form-group">
          <label class="form-label">
            Your Email (for updates) *
          </label>
          <input 
            type="email" 
            name="email" 
            required
            placeholder="your@email.com"
            class="form-input"
          />
        </div>

        <!-- Submit Button -->
        <button 
          type="submit"
          class="form-submit"
        >
          Submit Tool for Review
        </button>
      </form>
      
      <!-- Success Message -->
      <div id="success-message" class="success-message">
        <div class="success-icon">
          <span>✅</span>
        </div>
        <h2 class="success-title">Submission Received!</h2>
        <p class="success-text">
          Thank you for contributing to the Linux Directory. We'll review your submission and notify you within 24 hours.
        </p>
        <div class="success-actions">
          <a href="/" class="success-button">
            Back to Directory
          </a>
          <button onclick="location.reload()" class="success-button-secondary">
            Submit Another
          </button>
        </div>
      </div>
    </div>
    
  </div>
</Layout>

<script>
  // Form submission handler
  document.getElementById('submit-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    // Input sanitization - escape HTML characters to prevent XSS
    const escapeHtml = (text) => {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    };
    
    // Sanitize all form inputs
    const sanitizedData = {
      name: escapeHtml(data.name?.trim() || ''),
      category: escapeHtml(data.category?.trim() || ''),
      description: escapeHtml(data.description?.trim() || ''),
      website: data.website?.trim() || '',
      github: data.github?.trim() || '',
      tags: escapeHtml(data.tags?.trim() || ''),
      pricing: escapeHtml(data.pricing?.trim() || ''),
      // Don't store email in sanitizedData for security
      timestamp: new Date().toISOString(),
      id: 'submission_' + Date.now(),
      status: 'pending'
    };
    
    // Validate required fields
    if (!sanitizedData.name || !sanitizedData.category || !sanitizedData.description || !sanitizedData.website || !data.email?.trim()) {
      alert('Please fill in all required fields.');
      return;
    }
    
    // Store only non-sensitive submission data (without email)
    const submissions = JSON.parse(localStorage.getItem('linux_directory_submissions') || '[]');
    submissions.push(sanitizedData);
    localStorage.setItem('linux_directory_submissions', JSON.stringify(submissions));
    
    // Create email notification with sanitized data
    const emailSubject = `New Linux Directory Submission: ${sanitizedData.name}`;
    const emailBody = `🚀 NEW TOOL SUBMISSION for Linux Directory

📝 TOOL DETAILS:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- Tool Name: ${sanitizedData.name}
- Category: ${sanitizedData.category}
- Website: ${sanitizedData.website}
- Pricing: ${sanitizedData.pricing}

📄 Description:
${sanitizedData.description}

🏷️ Tags: ${sanitizedData.tags || 'None provided'}
🔗 GitHub: ${sanitizedData.github || 'Not provided'}

👤 SUBMITTER INFO:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- Email: ${escapeHtml(data.email)}
- Submitted: ${new Date().toLocaleString()}
- Submission ID: ${sanitizedData.id}

📋 NEXT STEPS:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. Review the tool and website
2. Verify information accuracy
3. Add to directory if approved
4. Reply to submitter

Happy curating! 🐧`;

    // Open email client with pre-filled content
    const mailtoLink = `mailto:fullstackdev2022@gmail.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
    
    // Show success message immediately
    document.getElementById('submit-form').style.display = 'none';
    document.getElementById('success-message').style.display = 'block';
    
    // Ask user if they want to open email notification
    setTimeout(() => {
      if (confirm('📧 Open email to notify the admin about this submission?')) {
        window.open(mailtoLink, '_blank');
      }
    }, 1500);
  });
  
  // Form validation improvements
  const form = document.getElementById('submit-form');
  const inputs = form?.querySelectorAll('input[required], select[required], textarea[required]');
  
  inputs?.forEach(input => {
    input.addEventListener('blur', () => {
      if (!input.value.trim()) {
        input.style.borderColor = '#ef4444';
      } else {
        input.style.borderColor = '#10b981';
      }
    });
  });
</script>